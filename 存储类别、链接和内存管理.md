# 存储类别

### 作用域

作用域描述程序中可访问标识符的区域，一个c变量的作用域可以是**块作用域**、**函数作用域**、**函数原型作用域**或**文件作用域**。

### 链接

c变量有3种链接属性：外部链接、内部链接或无链接。

> 具有块作用域、函数作用域或函数原型作用域的变量都是**无链接变量**。这些变量属于定义他们的块、函数或原型私有
>
> 具有文件作用域的变量可以实外部链接或内部链接，其中**外部链接变量**可以在多文件程序中使用，**内部链接变量**只能在一个翻译单元（即一个源代码文件和它所包含的头文件）中使用。

“内部链接的文件作用域” ：文件作用域（仅限于**一个翻译单元**）

“外部链接的文件作用域” ：全局作用域 或 程序作用域

:question:那么怎么知道文件作用域变量是内部链接还是外部链接的呢！

* 查看外部定义中是否使用了存储类别说明符`static`

  ```c
  int c = 2; //文件作用域，外部链接
  static int d = 3; //文件作用域，内部链接
  int main()
  {
      return 0;
  }
  ```

  指，

  * 该文件和同一程序的**其他文件**都可以使用变量c

  * 但是变量d属于**文件私有**，该文件中的任意函数都可以使用它



### 存储期

作用域和链接描述了**标识符的可见性**，那么存储期则是用来描述通过这些标识符访问的对象的**生存期**

C对象有4种存储期：静态存储期、线程存储期、自动存储期、动态分配存储期

1. 静态存储期

   那么它在程序的执行期间一直存在，**所有文件作用域变量**都具有静态存储期。

   对于文件作用域变量，关键字 `static`表明其链接属性（具有内部链接），而并非存储期

2. 线性存储期

   > 用于并发程序设计，程序执行可被分为多个线程，具有线程存储期的对象，从被声明时到线程结束一直存在，以关键词`_Thread_local`声明一个对象时，每个线程都获得该变量的私有备份。

   疑惑:question:什么东西，啥也不知道，不理解

   下次再来理解吧  ~~因为查不到资料~~ :cry:

3. 自动存储期

   * 块作用域的变量通常都具有自动存储期。

     当程序进入定义这些变量的块时，为这些变量分配内存；当退出这个块时，释放刚才为变量分配的内存。相当于，把自动变量占用的内存视为一个可重复使用的工作区或暂存区。

   * 然而，**块作用域变量也能具有静态存储期**，为了创建这样的变量，要把变量声明在块中，且在声明前面加上关键词`static`

     ```c
     int aaa(int a, int b)
     {
     	int result;
         static int pro = 0;
         ...
         return result;
     }
     ```

     * 变量pro存储在静态内存中，它从程序被载入到程序结束期间都存在，但是它的作用域定义在**`aaa()`函数块**中。**只有在执行该函数时**，程序才能使用pro访问它所指定的对象（<font color="grey">该函数可以给其他函数提供该存储区的地址来简介访问该对象，例如通过指针形参或返回值</font>）



| 存储类别         | 存储期 | 作用域 | 链接 | 声明方式                       |
| ---------------- | ------ | ------ | ---- | ------------------------------ |
| 自动`auto`       | 自动   | 块     | 无   | 块内                           |
| 寄存器`register` | 自动   | 块     | 无   | 块内，使用关键词`register`     |
| 静态外部链接     | 静态   | 文件   | 外部 | 所有函数外                     |
| 静态内部链接     | 静态   | 文件   | 内部 | 所有函数外，使用关键词`static` |
| 静态无链接       | 静态   | 块     | 无   | 块内，使用关键词`static`       |



